#!/usr/local/bin/ruby
require 'fileutils'
#FTP 接口地址：v1.ftp.upyun.com (电信)
#　　　　　　　v2.ftp.upyun.com (联通网通)
#　　　　　　　v3.ftp.upyun.com (移动铁通)
#　　　　　　　v0.ftp.upyun.com (自动判断）


USERNAME="pmq20/ktv-intrinsic-sub"
PASSWORD="jknlff8-pro-17m7755"
SERVER="v0.ftp.upyun.com"

ORIGIN="/home/main/ktv/_assets_sub/*"
TARGET="/"
FileUtils.rm_rf "/home/main/ktv/_assets_sub_uploading"
filepaths=[]
`diff --old-line-format=$'%l\\n' --new-line-format='' --changed-group-format='%<' --unchanged-group-format='' /home/main/ktv/_assets_sub/manifest.yml /home/main/ktv/_assets_sub_old/manifest.yml `.split("\n").each do |line|
  file = "#{line.split(': ')[-1]}"
  path = File.dirname(file) 
  FileUtils.mkdir_p("/home/main/ktv/_assets_sub_uploading/#{path}")
  FileUtils.cp("/home/main/ktv/_assets_sub/#{file}","/home/main/ktv/_assets_sub_uploading/#{file}")
end

puts cmd="ncftpput -m -S .tmp -u \"#{USERNAME}\" -p \"#{PASSWORD}\" -R #{SERVER} #{TARGET} /home/main/ktv/_assets_sub_uploading/*"
puts `#{cmd}`
